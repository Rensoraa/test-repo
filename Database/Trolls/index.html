<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link rel="icon" type="image/x-icon" href="favicon.ico">
<title>Non-Farmer Steam Profiles</title>
<link rel="stylesheet" href="style.css" />
<meta property="og:type" content="website">
<meta property="og:title" content="Non-Farmer Steam Profiles">
<meta property="og:description" content="A curated list of Steam profiles that are non-farmers or griefers on cross-off. Check profiles, reasons, and more.">
<meta property="og:image" content="https://rensoraa.github.io/Database/Trolls/assets/Metadata.png">
<meta property="og:url" content="https://rensoraa.github.io">
<meta name="theme-color" content="#4aa8ff">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="Non-Farmer Steam Profiles">
<meta name="twitter:description" content="A curated list of Steam profiles that are non-farmers or griefers on cross-off. Check profiles, reasons, and more.">
<meta name="twitter:image" content="https://rensoraa.github.io/Database/Trolls/assets/Metadata.png">
<meta name="twitter:site" content="@Rensora__">
<meta name="twitter:creator" content="@Rensora__">
<meta name="theme-color" content="#4aa8ff">
</head>
<body>
  <div id="loadingOverlay">
  <div class="loader"></div>
  <p>Connecting to Steam API...</p>
</div>

<div class="container">
  <h1 id="title">Collected Steam Profiles</h1>
  <a id="subtitle">These people either bring no offer or play normal/Grief others on cross-off</a>
  <p class="counter" id="profileCount">0 accounts stored</p>

  <div class="input-box">
    <input type="text" id="input" placeholder="Search Steam ID or Vanity" />
    <button id="searchBtn">Search</button>
    <button id="resetBtn">Show All</button>
    <select id="languageSelect">
      <option value="en">English</option>
      <option value="nl">Nederlands</option>
      <option value="de">Deutsch</option>
      <option value="zh">‰∏≠Êñá</option>
      <option value="ru">–†—É—Å—Å–∫–∏–π</option>
      <option value="tr">T√ºrk√ße</option>
      <option value="fr">Fran√ßais</option>
      <option value="it">Italiano</option>
      <option value="da">Dansk</option>
      <option value="es">Espa√±ol</option>
    </select>
  </div>

  <div id="profilesList" class="profiles-list"></div>
  <p id="error" class="error hidden"></p>
</div>

<button class="submit-button" id="submitBtn">Submit ID</button>
<button id="aboutButton" class="about-btn">About</button>

<div class="popup-overlay hidden" id="reasonOverlay">
  <div class="custom-popup">
    <p id="reasonText"></p>
    <button id="closeReason">Close</button>
  </div>
</div>

<div class="submission-overlay hidden" id="submissionOverlay">
  <div class="submission-popup">
    <h2 id="submitTitle">Submit a Steam ID / Profile</h2>
    <input type="text" id="steamIdInput" placeholder="Steam ID or Steam Profile Link" />
    <textarea id="reasonInput" rows="4" placeholder="Reason for submission"></textarea>
    <button id="submitFormBtn">Submit</button>
    <button id="closeSubmission">Cancel</button>
  </div>
</div>

<div class="custom-alert" id="customAlert"></div>

<script>
const workerUrl = "https://steam-api-proxy.itsnielsje.workers.dev";
const listContainer = document.getElementById("profilesList");
const error = document.getElementById("error");
const input = document.getElementById("input");
const searchBtn = document.getElementById("searchBtn");
const resetBtn = document.getElementById("resetBtn");
const profileCount = document.getElementById("profileCount");
const loadingOverlay = document.getElementById("loadingOverlay");

let profilesData = [];
let allowedProfiles = [];
let currentLang = localStorage.getItem("lang") || "en";
let lang = {};

// === LANGUAGE SYSTEM ===
const languageSelect = document.getElementById("languageSelect");

async function loadLanguage(code) {
  try {
    const res = await fetch(`lang/${code}.json`);
    lang = await res.json();

    document.getElementById("title").textContent = lang.title;
    document.getElementById("subtitle").textContent = lang.subtitle;
    searchBtn.textContent = lang.search;
    resetBtn.textContent = lang.show_all;
    document.getElementById("submitBtn").textContent = lang.submit_id;
    document.getElementById("submitTitle").textContent = lang.submit_title;
    document.getElementById("reasonInput").placeholder = lang.submit_reason_placeholder;
    document.getElementById("aboutButton").textContent = lang.about;


    refreshProfileCards();
  } catch (e) {
    console.warn("Failed to load language file:", code);
  }
}

languageSelect.addEventListener("change", () => {
  const selected = languageSelect.value;
  const previous = localStorage.getItem("lang");
  if (selected !== previous) {
    localStorage.setItem("lang", selected);
    currentLang = selected;
    loadLanguage(selected).then(() => {
      setTimeout(() => window.location.reload(), 200);
    });
  }
});

languageSelect.value = currentLang;
loadLanguage(currentLang);

// === PROFILE LOADING ===
async function loadProfiles() {
  const messages = [
    "Connecting to Steam API...",
    "Fetching Steam Profiles...",
    "Processing Data...",
    "Almost Done..."
  ];
  let i = 0;

  // Show loader
  loadingOverlay.classList.remove("hidden");

  // Cycle loading messages
  const interval = setInterval(() => {
    const msgElem = loadingOverlay.querySelector("p");
    if (msgElem) msgElem.textContent = messages[i % messages.length];
    i++;
  }, 1500);

  try {
    const res = await fetch("profiles.json");
    allowedProfiles = await res.json();

    for (const entry of allowedProfiles) {
      const idOrVanity = typeof entry === "string" ? entry : entry.id;
      const reason = typeof entry === "object" && entry.reason ? entry.reason : "No reason provided";

      const div = document.createElement("div");
      div.classList.add("profile");
      div.dataset.key = idOrVanity.toLowerCase();
      div.dataset.reason = reason;
      div.innerHTML = `<p>‚è≥ Connecting to Steam API...</p>`;
      listContainer.appendChild(div);

      const isNumeric = /^\d+$/.test(idOrVanity);
      const param = isNumeric ? `steamid=${idOrVanity}` : `vanity=${idOrVanity}`;

      try {
        const r = await fetch(`${workerUrl}/?${param}`);
        const data = await r.json();

        if (data && data.steamid) {
          div.dataset.steamid = data.steamid;
          div.dataset.personaname = data.personaname;
          div.dataset.avatar = data.avatarfull;
          div.dataset.profileurl = data.profileurl;

          profilesData.push(div);
          refreshProfileCard(div);
        } else {
          div.innerHTML = `<p>‚ö†Ô∏è Failed to load Steam profile.</p>`;
        }
      } catch (e) {
        console.error("Failed to load profile:", idOrVanity, e);
        div.innerHTML = `<p>‚ö†Ô∏è Failed to connect to Steam API.</p>`;
      }
    }

    profileCount.textContent = `${profilesData.length} accounts stored`;
  } catch (err) {
    console.error(err);
    error.textContent = "Failed to load profiles.json.";
    error.classList.remove("hidden");
  } finally {
    clearInterval(interval);

    // Hide loader with smooth transition
    setTimeout(() => {
      loadingOverlay.classList.add("hidden");
      setTimeout(() => {
        loadingOverlay.style.display = "none";
        document.getElementById("content").style.display = "block";
      }, 500);
    }, 500);
  }
}

// === REFRESH PROFILE CARD (single) ===
function refreshProfileCard(div) {
  if (!lang.view_on_steam) return;
  let reasonHTML;
  if (div.dataset.reason.length > 60) {
    reasonHTML = `<span class="clickable-reason" data-reason="${div.dataset.reason}">${lang.reason_click || "Reason: Click here"}</span>`;
  } else {
    reasonHTML = `${lang.reason_label || "Reason"}: ${div.dataset.reason}`;
  }

  div.innerHTML = `
    <img src="${div.dataset.avatar}" alt="Avatar">
    <div class="info">
      <h2>${div.dataset.personaname}</h2>
      <p><strong>Steam ID:</strong> ${div.dataset.steamid}</p>
      <p><strong>${reasonHTML}</strong></p>
      <a href="${div.dataset.profileurl}" target="_blank">üîó ${lang.view_on_steam || "View on Steam"}</a>
    </div>
  `;
}

// === REFRESH ALL PROFILE CARDS ===
function refreshProfileCards() {
  if (!lang.view_on_steam) return;
  listContainer.innerHTML = "";
  profilesData.forEach(refreshProfileCard);
}

// === SEARCH ===
function searchProfiles() {
  const query = input.value.trim().toLowerCase();
  listContainer.innerHTML = "";
  if (!query) {
    refreshProfileCards();
    return;
  }

  const matched = profilesData.filter(card => card.dataset.key.includes(query));
  if (matched.length === 0) {
    error.textContent = "No profile found in the database.";
    error.classList.remove("hidden");
  } else {
    error.classList.add("hidden");
    matched.forEach(card => listContainer.appendChild(card));
  }
}

function resetSearch() {
  input.value = "";
  refreshProfileCards();
  error.classList.add("hidden");
}

searchBtn.addEventListener("click", searchProfiles);
resetBtn.addEventListener("click", resetSearch);
loadProfiles();

// === REASON POPUP ===
const reasonOverlay = document.getElementById("reasonOverlay");
const reasonText = document.getElementById("reasonText");
const closeReason = document.getElementById("closeReason");

document.addEventListener("click", (e) => {
  if (e.target.classList.contains("clickable-reason")) {
    reasonText.innerHTML = e.target.dataset.reason.replace(/\n/g, "<br>");
    reasonOverlay.classList.remove("hidden");
  }
});

closeReason.addEventListener("click", () => reasonOverlay.classList.add("hidden"));
reasonOverlay.addEventListener("click", e => {
  if (e.target === reasonOverlay) reasonOverlay.classList.add("hidden");
});

// === SUBMISSION ===
const submitBtn = document.getElementById("submitBtn");
const submissionOverlay = document.getElementById("submissionOverlay");
const closeSubmission = document.getElementById("closeSubmission");
const submitFormBtn = document.getElementById("submitFormBtn");
const steamIdInput = document.getElementById("steamIdInput");
const reasonInput = document.getElementById("reasonInput");
const customAlert = document.getElementById("customAlert");

submitBtn.addEventListener("click", () => submissionOverlay.classList.remove("hidden"));
closeSubmission.addEventListener("click", () => submissionOverlay.classList.add("hidden"));
submissionOverlay.addEventListener("click", e => {
  if (e.target === submissionOverlay) submissionOverlay.classList.add("hidden");
});

function showAlert(msg, duration = 3000) {
  customAlert.textContent = msg;
  customAlert.style.display = "block";
  setTimeout(() => { customAlert.style.display = "none"; }, duration);
}

submitFormBtn.addEventListener("click", async () => {
  const steamId = steamIdInput.value.trim();
  const reason = reasonInput.value.trim();
  if (!steamId || !reason) {
    showAlert(lang.submit_fail || "Please fill in both Steam ID/Link and Reason");
    return;
  }

  let displayValue = steamId;
  const vanityMatch = steamId.match(/steamcommunity\.com\/id\/([^/]+)/);
  const idMatch = steamId.match(/(\d{17})/);

  if (vanityMatch) displayValue = `[${vanityMatch[1]}](${steamId})`;
  else if (idMatch) displayValue = `Steam ID: ${idMatch[1]}`;

  const webhookUrl = "https://discord.com/api/webhooks/1430636173612552265/A1aQbkqlBuRctnCjG54LvtrP1ldQFCV7x8S2BMc6Vidrl1QK8rw7Re-WK1lWj9Tcq1gj";
  const payload = {
    content: "<@929521121475313804>",
    embeds: [{
      title: "New Steam ID Submission | Non-Farmer database",
      color: 0x005f9e,
      fields: [
        { name: "Steam ID / Profile", value: displayValue, inline: false },
        { name: "Reason", value: reason, inline: false }
      ],
      timestamp: new Date().toISOString()
    }]
  };

  try {
    const res = await fetch(webhookUrl, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(payload)
    });

    if (res.ok) {
      showAlert(lang.submit_success || "Submission sent successfully!");
      steamIdInput.value = "";
      reasonInput.value = "";
      submissionOverlay.classList.add("hidden");
    } else showAlert(lang.submit_fail || "Failed to send submission.");
  } catch (err) {
    console.error(err);
    showAlert(lang.submit_fail || "Error sending submission.");
  }
});
</script>
<script>
  document.getElementById("aboutButton").addEventListener("click", () => {
    window.location.href = "about.html";
  });
</script>
</body>
</html>
